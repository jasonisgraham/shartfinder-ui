<!doctype html>
<html>

<head>

	<title>Shartfinder</title>

	<meta name="viewport" 
	content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

	<script src="components/webcomponentsjs/webcomponents.js">
	</script>

	<link rel="import" href="combatant-list.html">
	<link rel="import" href="start-encounter.html">
	<link rel="import" href="x-websocket.html">
	
	<style>
		html,body {
			height: 100%;
			margin: 0;
			background-color: #E5E5E5;
			font-family: sans-serif;
		}
		.container {
			width: 80%;
			margin: 50px auto;
		}
		@media (min-width: 481px) {
			.container {
				width: 200px;
			}
		}
	</style>

</head>

<body unresolved>
	
	<div class="container" layout vertical center>

	<x-websocket json></x-websocket>
	
	<start-encounter></start-encounter>
		
		<combatant-list></combatant-list>
	</div>
	
	<script>
	window.addEventListener('polymer-ready', function(e) {
			var xws = document.querySelector("x-websocket");
			var cl = document.querySelector("combatant-list");
			var se = document.querySelector("start-encounter");
			xws.addEventListener("message", function(event) {
				console.log("message", event.detail.data);
				  var eventName = event.detail.data.eventName;
				  var payload = event.detail.data.payload;
					if (eventName === "add-combatant"){
						cl.combatants.push(payload);
					} 
					if (eventName === "start-encounter"){
						se.show = false;
						cl.show = 'initiative';
					} 
					if (eventName === "initiative-created"){
						cl.combatants = [];
						for (var key in payload.orderedCombatants) {
							cl.combatants.push(payload.orderedCombatants[key]);
						} 
						cl.show = 'round-started';
					}
			});
		});
	</script>

</body>

</html>
