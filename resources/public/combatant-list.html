<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="combatant-card.html">
<link rel="import" href="combatant-service.html">
<link rel="import" href="x-websocket.html">

<polymer-element name="combatant-list" attributes="combatants showView show user">
  <template>
    <style>
    :host {
      display: block;
      width: 100%;
    }
    combatant-card {
      margin-top: 30px;
    }
    </style>
	
	<combatant-service id="service" combatants="{{combatants}}">
	</combatant-service>

	
	<div layout vertical center>
	
	  <input type="text" value="{{combatantName}}" hidden?="{{!show || showView != 'add-combatant'}}"> <button on-click="{{addCombatant}}"  hidden?="{{!show || showView != 'add-combatant'}}">Add Combatant</button>

	  <template repeat="{{combatant in combatants}}">
		<combatant-card 
		selected="{{combatant.selected}}"
		  showView="{{showView}}"
		  user="{{user}}"
		  combatantName="{{combatant.combatantName}}"
		  mine="{{combatant.mine}}"
		  hidden?="{{!show || (showView == 'initiative' && !combatant.selected)}}">
		  {{combatant.combatantName}}
		</combatant-card>
	  </template>

	</div>
	
  </template>

  <script>
  Polymer({
   publish: {
		show: {
			value: false,
			reflect: true
		},
		showView: {
			value: "add-combatant",
			reflect: true
		}
	  },
	addCombatant: function() {
		var containsKey = false;
		for (var key in this.combatants) {
			if (this.combatants[key].combatantName === this.combatantName) {
				containsKey = true;
				break;
			}
		}
		if (!containsKey){
			var addCombatantData = { data: { combatantName: this.combatantName, user: this.user }, eventName: "add-combatant" };
			var xws = document.querySelector("x-websocket");
			xws.send(addCombatantData);
		}
		this.combatantName = '';
	  }
	});
  </script>

</polymer-element>
